<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Anes Travel — أماكن طبيعية + أفضل فنادق الجزائر</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root{--accent:#0b79d0;--card:#ffffff}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Tahoma,Arial,Helvetica,sans-serif;background:#e9f2ef}
  body::before{
    content:"";position:fixed;inset:0;background-image:url('https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=2000&q=60');
    background-size:cover;background-position:center;filter:blur(6px) brightness(0.6);z-index:-2
  }
  header{background:rgba(255,255,255,0.9);backdrop-filter:blur(4px);padding:12px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
  h1{margin:0;font-size:20px;color:#063449}
  .brand-sub{color:#2b6777;font-size:13px}
  .container{max-width:1200px;margin:14px auto;padding:12px;background:rgba(255,255,255,0.9);border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.08)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
  input[type=text]{padding:10px;border-radius:10px;border:1px solid #cfd8dc;width:320px;font-size:15px}
  button{padding:9px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-weight:600}
  button.ghost{background:#fff;color:var(--accent);border:1px solid rgba(11,121,208,0.15)}
  .filters{display:flex;gap:6px;flex-wrap:wrap}
  .filters button{background:#fff;color:#333;border:1px solid #e1eef6;padding:8px 10px}
  .toggle{display:flex;border:1px solid #cfe4f6;border-radius:12px;overflow:hidden}
  .toggle button{background:#fff;color:#063449;border:0;padding:8px 12px}
  .toggle button.active{background:var(--accent);color:#fff}
  .layout{display:grid;grid-template-columns:1fr 380px;gap:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .card{background:var(--card);border-radius:10px;padding:10px;box-shadow:0 2px 8px rgba(2,6,23,0.06);overflow:hidden}
  .card img{width:100%;height:160px;object-fit:cover;border-radius:8px}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .badge{background:#eef7ff;color:var(--accent);padding:4px 8px;border-radius:6px;font-size:12px}
  .small{font-size:13px;color:#444}
  #map{height:580px;border-radius:10px}
  .detail{display:none}
  .back{margin-bottom:10px}
  .stars{cursor:pointer;font-size:20px}
  .comment{border-top:1px solid #eee;padding:10px 0}
  footer{margin-top:10px;color:#555;font-size:13px;text-align:center}
  @media (max-width:980px){ .layout{grid-template-columns:1fr} #map{height:320px} input[type=text]{width:60%} }
</style>
</head>
<body>

<header>
  <div>
    <h1>Anes Travel</h1>
    <div class="brand-sub">دليل الأماكن الطبيعية + سلسلة أفضل الفنادق في الجزائر</div>
  </div>
  <div style="flex:1"></div>
  <button id="locateBtn" title="تحديد موقعي">📍 حدد موقعي</button>
</header>

<div class="container">
  <div class="controls">
    <div class="toggle" role="tablist" aria-label="وضع العرض">
      <button id="tabAll" class="active" role="tab" aria-selected="true">الكل</button>
      <button id="tabHotels" role="tab" aria-selected="false">فنادق فقط</button>
    </div>

    <input id="searchBox" type="text" placeholder="ابحث باسم الولاية / المكان / الفندق...">
    <button id="searchBtn">🔎 بحث</button>
    <button id="clearBtn" class="ghost">🔄 رجوع</button>

    <div style="flex:1"></div>

    <div class="filters">
      <button class="filterBtn" data-type="شواطئ">🏖 شواطئ</button>
      <button class="filterBtn" data-type="وديان">🏞 وديان</button>
      <button class="filterBtn" data-type="سدود">💧 سدود</button>
      <button class="filterBtn" data-type="هضاب">⛰ هضاب</button>
      <button class="filterBtn" data-type="سهول">🌾 سهول</button>
      <button class="filterBtn" data-type="أنهار">🌊 أنهار</button>
      <button class="filterBtn" data-type="جبال">🏔 جبال</button>
      <button class="filterBtn" data-type="غابات">🌳 غابات</button>
      <button class="filterBtn" data-type="فنادق">🏨 فنادق</button>
    </div>
  </div>

  <div class="layout">
    <div>
      <div id="resultsInfo" class="small">—</div>
      <div id="grid" class="grid" aria-live="polite"></div>
    </div>

    <div>
      <div id="map" aria-label="خريطة"></div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:space-between;align-items:center">
        <div class="small">انقر لعرض التفاصيل / الأماكن القريبة</div>
        <button id="showAllBtn" class="ghost">عرض الكل</button>
      </div>
    </div>
  </div>

  <div id="detailView" class="detail">
    <button id="backBtn" class="back ghost">⬅️ رجوع</button>
    <div id="detailCard" class="card"></div>
  </div>

  <footer>التقييمات والتعليقات محفوظة محليًا في متصفحك — الصور من Unsplash/Wikimedia</footer>
</div>

<script>
// ====== أدوات مساعدة ======
function normalizeText(s){
  if(!s) return '';
  return s.toString()
    .replace(/[ًٌٍَُِْـ]/g,'')
    .replace(/[آأإ]/g,'ا').replace(/ى/g,'ي').replace(/ؤ|ئ/g,'ء').replace(/ة/g,'ه')
    .replace(/\s+/g,' ').trim().toLowerCase();
}
function calcDist(lat1,lon1,lat2,lon2){
  lat1=Number(lat1);lon1=Number(lon1);lat2=Number(lat2);lon2=Number(lon2);
  if(!lat2||!lon2||isNaN(lat2)||isNaN(lon2)) return null;
  const R=6371, dLat=(lat2-lat1)*Math.PI/180, dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return Math.round(R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*10)/10;
}

// ====== بيانات الأماكن الطبيعية (مختصر) ======
// ملاحظة: لو عندك ملف سابق بـ 100 مكان، يمكنك دمجه هنا بسهولة (نفس البنية).
const places = [
  {"id":"p1","name":"القصبة","state":"الجزائر","type":"تاريخي","description":"حي قصبة الجزائر العتيق.","lat":36.7529,"lng":3.0588,"image":"https://source.unsplash.com/1200x800/?algiers,casbah"},
  {"id":"p2","name":"حديقة التجارب","state":"الجزائر","type":"طبيعة","description":"حديقة نباتية مميزة.","lat":36.7506,"lng":3.0583,"image":"https://source.unsplash.com/1200x800/?botanical,garden"},
  {"id":"p3","name":"قلعة سانتا كروز","state":"وهران","type":"تاريخي","description":"إطلالة على وهران والبحر.","lat":35.6911,"lng":-0.6346,"image":"https://source.unsplash.com/1200x800/?castle,orano"},
  {"id":"p4","name":"جسر سيدي مسيد","state":"قسنطينة","type":"معلم","description":"الجسر المعلّق الشهير.","lat":36.3650,"lng":6.6147,"image":"https://source.unsplash.com/1200x800/?suspension,bridge"},
  {"id":"p5","name":"كاب كربون","state":"بجاية","type":"منحدر بحري","description":"منحدرات بحرية ساحرة.","lat":36.7763,"lng":5.0875,"image":"https://source.unsplash.com/1200x800/?bejaia,cliffs"},
  {"id":"p6","name":"سواحل جيجل","state":"جيجل","type":"شواطئ","description":"سواحل رملية وصخور.","lat":36.8200,"lng":5.7500,"image":"https://source.unsplash.com/1200x800/?jijel,beach"},
  {"id":"p7","name":"موقع تيبازة الأثري","state":"تيبازة","type":"آثاري","description":"آثار رومانية على الساحل.","lat":36.5896,"lng":2.4476,"image":"https://source.unsplash.com/1200x800/?tipasa,ruins"},
  {"id":"p8","name":"جبال الهقار","state":"تمنراست","type":"جبال","description":"صخور وتكوينات فريدة.","lat":22.7850,"lng":5.5228,"image":"https://source.unsplash.com/1200x800/?hoggar,algeria"},
  {"id":"p9","name":"وادي مزاب","state":"غرداية","type":"ثقافي","description":"عمارة مزابية مميزة.","lat":32.4894,"lng":3.6735,"image":"https://source.unsplash.com/1200x800/?ghardaia,oasis"},
  {"id":"p10","name":"شواطئ عنابة","state":"عنابة","type":"شواطئ","description":"كورنيش ومياه صافية.","lat":36.9000,"lng":7.7667,"image":"https://source.unsplash.com/1200x800/?annaba,beach"}
];

// ====== بيانات الفنادق (فندق/فندقان لكل ولاية) ======
const hotels = [
  // تنبيه: أسماء الفنادق عامة/توضيحية بصور عامة عالية الجودة (مصادر مفتوحة). يمكنك لاحقاً استبدالها بأسماء فعلية.
  {"id":"h01","name":"فندق الجزائر سيتي","state":"الجزائر","type":"فنادق","description":"فندق موصى به في وسط العاصمة.","lat":36.767,"lng":3.05,"image":"https://source.unsplash.com/1200x800/?hotel,algiers","maps":"https://maps.google.com/?q=Algiers"},
  {"id":"h02","name":"فندق وهران بلازا","state":"وهران","type":"فنادق","description":"قريب من الكورنيش ووسط المدينة.","lat":35.704,"lng":-0.65,"image":"https://source.unsplash.com/1200x800/?hotel,oran","maps":"https://maps.google.com/?q=Oran"},
  {"id":"h03","name":"فندق قسنطينة فيو","state":"قسنطينة","type":"فنادق","description":"غرف مطلة على الجسور المعلّقة.","lat":36.36,"lng":6.61,"image":"https://source.unsplash.com/1200x800/?hotel,constantine","maps":"https://maps.google.com/?q=Constantine"},
  {"id":"h04","name":"فندق عنابة كورنيش","state":"عنابة","type":"فنادق","description":"مطل على البحر وخدمات عائلية.","lat":36.9,"lng":7.77,"image":"https://source.unsplash.com/1200x800/?hotel,seaside","maps":"https://maps.google.com/?q=Annaba"},
  {"id":"h05","name":"فندق بجاية باي","state":"بجاية","type":"فنادق","description":"إطلالة على الخليج وكاب كربون.","lat":36.76,"lng":5.07,"image":"https://source.unsplash.com/1200x800/?hotel,bejaia","maps":"https://maps.google.com/?q=Bejaia"},
  {"id":"h06","name":"فندق جيجل بيتش","state":"جيجل","type":"فنادق","description":"ممر مباشر إلى الشاطئ.","lat":36.82,"lng":5.74,"image":"https://source.unsplash.com/1200x800/?hotel,beach","maps":"https://maps.google.com/?q=Jijel"},
  {"id":"h07","name":"فندق تيبازة ريزورت","state":"تيبازة","type":"فنادق","description":"قريب من الآثار الرومانية.","lat":36.59,"lng":2.45,"image":"https://source.unsplash.com/1200x800/?hotel,resort","maps":"https://maps.google.com/?q=Tipaza"},
  {"id":"h08","name":"فندق تلمسان هيريتاج","state":"تلمسان","type":"فنادق","description":"طابع أندلسي تقليدي.","lat":34.88,"lng":-1.32,"image":"https://source.unsplash.com/1200x800/?hotel,riad","maps":"https://maps.google.com/?q=Tlemcen"},
  {"id":"h09","name":"فندق تيزي وزو جراند","state":"تيزي وزو","type":"فنادق","description":"قريب من جبال جرجرة.","lat":36.71,"lng":4.05,"image":"https://source.unsplash.com/1200x800/?hotel,mountains","maps":"https://maps.google.com/?q=Tizi%20Ouzou"},
  {"id":"h10","name":"فندق سطيف سنتر","state":"سطيف","type":"فنادق","description":"وسط المدينة، مناسب للأعمال.","lat":36.19,"lng":5.41,"image":"https://source.unsplash.com/1200x800/?business,hotel","maps":"https://maps.google.com/?q=Setif"},
  {"id":"h11","name":"فندق مستغانم مارينا","state":"مستغانم","type":"فنادق","description":"مطل على المرسى والشاطئ.","lat":35.93,"lng":0.09,"image":"https://source.unsplash.com/1200x800/?marina,hotel","maps":"https://maps.google.com/?q=Mostaganem"},
  {"id":"h12","name":"فندق بسكرة واحة","state":"بسكرة","type":"فنادق","description":"أجواء نخيل وسبا.","lat":34.86,"lng":5.73,"image":"https://source.unsplash.com/1200x800/?desert,hotel","maps":"https://maps.google.com/?q=Biskra"},
  {"id":"h13","name":"فندق تبسة جراند","state":"تبسة","type":"فنادق","description":"قريب من المواقع الأثرية.","lat":35.41,"lng":8.12,"image":"https://source.unsplash.com/1200x800/?hotel,city","maps":"https://maps.google.com/?q=Tebessa"},
  {"id":"h14","name":"فندق أدرار ديزرت لودج","state":"أدرار","type":"فنادق","description":"نمط صحراوي تقليدي.","lat":27.87,"lng":0.28,"image":"https://source.unsplash.com/1200x800/?desert,lodge","maps":"https://maps.google.com/?q=Adrar"},
  {"id":"h15","name":"فندق الشلف بلو","state":"الشلف","type":"فنادق","description":"إقامة مريحة وقريبة من البحر.","lat":36.16,"lng":1.33,"image":"https://source.unsplash.com/1200x800/?hotel,coast","maps":"https://maps.google.com/?q=Chlef"},
  {"id":"h16","name":"فندق الأغواط أويسس","state":"الأغواط","type":"فنادق","description":"هدوء وصحارى.","lat":33.81,"lng":2.87,"image":"https://source.unsplash.com/1200x800/?oasis,hotel","maps":"https://maps.google.com/?q=Laghouat"},
  {"id":"h17","name":"فندق أم البواقي بارك","state":"أم البواقي","type":"فنادق","description":"قريب من المرافق والخدمات.","lat":35.87,"lng":7.11,"image":"https://source.unsplash.com/1200x800/?city,hotel","maps":"https://maps.google.com/?q=Oum%20El%20Bouaghi"},
  {"id":"h18","name":"فندق باتنة أوراس","state":"باتنة","type":"فنادق","description":"أجواء جبلية أوراسية.","lat":35.56,"lng":6.17,"image":"https://source.unsplash.com/1200x800/?mountain,hotel","maps":"https://maps.google.com/?q=Batna"},
  {"id":"h19","name":"فندق بجاية كورال","state":"بجاية","type":"فنادق","description":"قرب الكورنيش والشواطئ.","lat":36.76,"lng":5.06,"image":"https://source.unsplash.com/1200x800/?seaside,hotel","maps":"https://maps.google.com/?q=Bejaia"},
  {"id":"h20","name":"فندق بسكرة بالاس","state":"بسكرة","type":"فنادق","description":"رفاهية في قلب الواحات.","lat":34.86,"lng":5.73,"image":"https://source.unsplash.com/1200x800/?palm,hotel","maps":"https://maps.google.com/?q=Biskra%20Palace"},
  {"id":"h21","name":"فندق بشار صحراوي","state":"بشار","type":"فنادق","description":"تصميم صحراوي حديث.","lat":31.61,"lng":-2.22,"image":"https://source.unsplash.com/1200x800/?sahara,hotel","maps":"https://maps.google.com/?q=Bechar"},
  {"id":"h22","name":"فندق البليدة غاردن","state":"البليدة","type":"فنادق","description":"قريب من الشريعة والحدائق.","lat":36.47,"lng":2.83,"image":"https://source.unsplash.com/1200x800/?garden,hotel","maps":"https://maps.google.com/?q=Blida"},
  {"id":"h23","name":"فندق البويرة ليك فيو","state":"البويرة","type":"فنادق","description":"إطلالة على البحيرات والجبال.","lat":36.38,"lng":3.90,"image":"https://source.unsplash.com/1200x800/?lake,hotel","maps":"https://maps.google.com/?q=Bouira"},
  {"id":"h24","name":"فندق تمنراست هوغار","state":"تمنراست","type":"فنادق","description":"قرب تشكيلات الهقار.","lat":22.78,"lng":5.52,"image":"https://source.unsplash.com/1200x800/?hoggar,hotel","maps":"https://maps.google.com/?q=Tamanrasset"},
  {"id":"h25","name":"فندق تبسة هيريتاج","state":"تبسة","type":"فنادق","description":"لمسات تقليدية قريبة من الآثار.","lat":35.41,"lng":8.12,"image":"https://source.unsplash.com/1200x800/?heritage,hotel","maps":"https://maps.google.com/?q=Tebessa%20Hotel"},
  {"id":"h26","name":"فندق تلمسان أندلس","state":"تلمسان","type":"فنادق","description":"أسلوب أندلسي وحدائق.","lat":34.88,"lng":-1.32,"image":"https://source.unsplash.com/1200x800/?andalusian,hotel","maps":"https://maps.google.com/?q=Tlemcen%20Hotel"},
  {"id":"h27","name":"فندق تيارت هايلاند","state":"تيارت","type":"فنادق","description":"أجواء هضاب هادئة.","lat":35.37,"lng":1.32,"image":"https://source.unsplash.com/1200x800/?highlands,hotel","maps":"https://maps.google.com/?q=Tiaret"},
  {"id":"h28","name":"فندق تيزي وزو جرجرة","state":"تيزي وزو","type":"فنادق","description":"قرب جبال جرجرة.","lat":36.71,"lng":4.05,"image":"https://source.unsplash.com/1200x800/?djurdjura,hotel","maps":"https://maps.google.com/?q=Djurdjura"},
  {"id":"h29","name":"فندق الجزائر باي فيو","state":"الجزائر","type":"فنادق","description":"إطلالة على خليج العاصمة.","lat":36.78,"lng":3.06,"image":"https://source.unsplash.com/1200x800/?bay,hotel","maps":"https://maps.google.com/?q=Algiers%20Bay"},
  {"id":"h30","name":"فندق جيجل كورنيش","state":"جيجل","type":"فنادق","description":"قرب الكهوف والشواطئ.","lat":36.82,"lng":5.75,"image":"https://source.unsplash.com/1200x800/?cliffs,hotel","maps":"https://maps.google.com/?q=Jijel%20Hotel"},
  {"id":"h31","name":"فندق سيدي بلعباس بارك","state":"سيدي بلعباس","type":"فنادق","description":"هادئ ومناسب للعائلات.","lat":35.19,"lng":-0.63,"image":"https://source.unsplash.com/1200x800/?park,hotel","maps":"https://maps.google.com/?q=Sidi%20Bel%20Abbes"},
  {"id":"h32","name":"فندق عنابة مارين","state":"عنابة","type":"فنادق","description":"على المرسى مباشرة.","lat":36.9,"lng":7.77,"image":"https://source.unsplash.com/1200x800/?marina,hotel","maps":"https://maps.google.com/?q=Annaba%20Marina"},
  {"id":"h33","name":"فندق قالمة هيل","state":"قالمة","type":"فنادق","description":"بيئة خضراء وإطلالة ريفية.","lat":36.47,"lng":7.43,"image":"https://source.unsplash.com/1200x800/?countryside,hotel","maps":"https://maps.google.com/?q=Guelma"},
  {"id":"h34","name":"فندق سكيكدة سي فيو","state":"سكيكدة","type":"فنادق","description":"مطل على البحر.","lat":36.88,"lng":6.91,"image":"https://source.unsplash.com/1200x800/?sea,hotel","maps":"https://maps.google.com/?q=Skikda"},
  {"id":"h35","name":"فندق سطيف بزنس","state":"سطيف","type":"فنادق","description":"خدمات أعمال ومطعم.","lat":36.19,"lng":5.41,"image":"https://source.unsplash.com/1200x800/?hotel,lobby","maps":"https://maps.google.com/?q=Setif%20Business"},
  {"id":"h36","name":"فندق المسيلة لينكس","state":"المسيلة","type":"فنادق","description":"موقع مركزي وخدمات جيدة.","lat":35.70,"lng":4.53,"image":"https://source.unsplash.com/1200x800/?hotel,room","maps":"https://maps.google.com/?q=M'sila"},
  {"id":"h37","name":"فندق معسكر أولد تاون","state":"معسكر","type":"فنادق","description":"قريب من الأسواق التقليدية.","lat":35.39,"lng":0.14,"image":"https://source.unsplash.com/1200x800/?old,hotel","maps":"https://maps.google.com/?q=Mascara"},
  {"id":"h38","name":"فندق ورقلة أويسس","state":"ورقلة","type":"فنادق","description":"نخيل وبرك سباحة.","lat":31.96,"lng":5.33,"image":"https://source.unsplash.com/1200x800/?oasis,resort","maps":"https://maps.google.com/?q=Ouargla"},
  {"id":"h39","name":"فندق البيض هضاب","state":"البيض","type":"فنادق","description":"أجواء هادئة على الهضاب.","lat":33.68,"lng":1.01,"image":"https://source.unsplash.com/1200x800/?plateau,hotel","maps":"https://maps.google.com/?q=El%20Bayadh"},
  {"id":"h40","name":"فندق إليزي صحراوي","state":"إليزي","type":"فنادق","description":"تشكيلات طاسيلي قريبة.","lat":26.50,"lng":8.48,"image":"https://source.unsplash.com/1200x800/?tassili,hotel","maps":"https://maps.google.com/?q=Illizi"},
  {"id":"h41","name":"فندق برج بوعريريج سنتر","state":"برج بوعريريج","type":"فنادق","description":"إقامة مريحة وسط المدينة.","lat":36.07,"lng":4.76,"image":"https://source.unsplash.com/1200x800/?hotel,urban","maps":"https://maps.google.com/?q=Bordj%20Bou%20Arreridj"},
  {"id":"h42","name":"فندق الطارف لاجون","state":"الطارف","type":"فنادق","description":"قرب البحيرات والشواطئ.","lat":36.77,"lng":8.31,"image":"https://source.unsplash.com/1200x800/?lagoon,hotel","maps":"https://maps.google.com/?q=El%20Tarf"},
  {"id":"h43","name":"فندق تندوف ديزرت","state":"تندوف","type":"فنادق","description":"هدوء صحراوي بعيد.","lat":27.67,"lng":-8.15,"image":"https://source.unsplash.com/1200x800/?desert,hotel","maps":"https://maps.google.com/?q=Tindouf"},
  {"id":"h44","name":"فندق تيسمسيلت غرين","state":"تيسمسيلت","type":"فنادق","description":"طبيعة خضراء وجبال.","lat":35.61,"lng":1.81,"image":"https://source.unsplash.com/1200x800/?green,hotel","maps":"https://maps.google.com/?q=Tissemsilt"},
  {"id":"h45","name":"فندق الوادي وادي سوف","state":"الوادي","type":"فنادق","description":"كثبان ورمال ذهبية.","lat":33.37,"lng":6.86,"image":"https://source.unsplash.com/1200x800/?dunes,hotel","maps":"https://maps.google.com/?q=El%20Oued"},
  {"id":"h46","name":"فندق خنشلة هيلز","state":"خنشلة","type":"فنادق","description":"مرتفعات وهواء نقي.","lat":35.43,"lng":7.14,"image":"https://source.unsplash.com/1200x800/?hills,hotel","maps":"https://maps.google.com/?q=Khenchela"},
  {"id":"h47","name":"فندق سوق أهراس هيريتاج","state":"سوق أهراس","type":"فنادق","description":"قرب المواقع الأثرية.","lat":36.28,"lng":7.95,"image":"https://source.unsplash.com/1200x800/?heritage,hotel","maps":"https://maps.google.com/?q=Souk%20Ahras"},
  {"id":"h48","name":"فندق تيبازة كاب","state":"تيبازة","type":"فنادق","description":"إطلالة كاب حنايا.","lat":36.59,"lng":2.45,"image":"https://source.unsplash.com/1200x800/?coast,hotel","maps":"https://maps.google.com/?q=Tipasa%20Cap"},
  {"id":"h49","name":"فندق ميلة فالّي","state":"ميلة","type":"فنادق","description":"قرب الأودية والتلال.","lat":36.45,"lng":6.26,"image":"https://source.unsplash.com/1200x800/?valley,hotel","maps":"https://maps.google.com/?q=Mila"},
  {"id":"h50","name":"فندق عين الدفلى ريفير","state":"عين الدفلى","type":"فنادق","description":"بالقرب من مجاري مائية طبيعية.","lat":36.26,"lng":1.97,"image":"https://source.unsplash.com/1200x800/?river,hotel","maps":"https://maps.google.com/?q=Ain%20Defla"},
  {"id":"h51","name":"فندق النعامة ستِيب","state":"النعامة","type":"فنادق","description":"مناظر هضاب وسهوب.","lat":33.27,"lng":0.31,"image":"https://source.unsplash.com/1200x800/?steppe,hotel","maps":"https://maps.google.com/?q=Naama"},
  {"id":"h52","name":"فندق غرداية مزاب","state":"غرداية","type":"فنادق","description":"طابع مزابي تقليدي.","lat":32.49,"lng":3.67,"image":"https://source.unsplash.com/1200x800/?ghardaia,hotel","maps":"https://maps.google.com/?q=Ghardaia"},
  {"id":"h53","name":"فندق غليزان ريفرسايد","state":"غليزان","type":"فنادق","description":"بيئة هادئة وخدمات جيدة.","lat":35.73,"lng":0.56,"image":"https://source.unsplash.com/1200x800/?riverside,hotel","maps":"https://maps.google.com/?q=Relizane"},
  {"id":"h54","name":"فندق قالمة سنسبا","state":"قالمة","type":"فنادق","description":"قرب الينابيع الحارة.","lat":36.47,"lng":7.43,"image":"https://source.unsplash.com/1200x800/?spa,hotel","maps":"https://maps.google.com/?q=Guelma%20Spa"},
  {"id":"h55","name":"فندق برج باجي مختار ديزرت","state":"برج باجي مختار","type":"فنادق","description":"مغامرة صحراوية.","lat":21.33,"lng":0.96,"image":"https://source.unsplash.com/1200x800/?sahara,lodge","maps":"https://maps.google.com/?q=Bordj%20Badji%20Mokhtar"},
  {"id":"h56","name":"فندق بني عباس أويسس","state":"بني عباس","type":"فنادق","description":"نخيل وواحات جميلة.","lat":30.13,"lng":-2.17,"image":"https://source.unsplash.com/1200x800/?oasis,guesthouse","maps":"https://maps.google.com/?q=Beni%20Abbes"},
  {"id":"h57","name":"فندق إن صالح ديونز","state":"إن صالح","type":"فنادق","description":"قرب الكثبان الرملية.","lat":27.21,"lng":2.49,"image":"https://source.unsplash.com/1200x800/?dunes,lodge","maps":"https://maps.google.com/?q=In%20Salah"},
  {"id":"h58","name":"فندق تيميمون رِد ساند","state":"تيميمون","type":"فنادق","description":"رمال حمراء وإقامة تراثية.","lat":29.26,"lng":0.27,"image":"https://source.unsplash.com/1200x800/?red,sand,hotel","maps":"https://maps.google.com/?q=Timimoun"},
  {"id":"h59","name":"فندق أولاد جلال ساند هاوس","state":"أولاد جلال","type":"فنادق","description":"أجواء صحراوية هادئة.","lat":34.44,"lng":5.00,"image":"https://source.unsplash.com/1200x800/?desert,guesthouse","maps":"https://maps.google.com/?q=Ouled%20Djellal"},
  {"id":"h60","name":"فندق المغير أويسس لودج","state":"المغير","type":"فنادق","description":"راحة بين الواحات.","lat":33.95,"lng":6.86,"image":"https://source.unsplash.com/1200x800/?oasis,hotel","maps":"https://maps.google.com/?q=El%20M'Ghair"},
  {"id":"h61","name":"فندق المنيعة جراند","state":"المنيعة","type":"فنادق","description":"على طريق الصحراء الكبرى.","lat":32.83,"lng":0.60,"image":"https://source.unsplash.com/1200x800/?desert,hotel,algeria","maps":"https://maps.google.com/?q=El%20Menia"},
  {"id":"h62","name":"فندق جانت تاسيلي","state":"جانت","type":"فنادق","description":"قرب طاسيلي ناجر.","lat":24.55,"lng":9.48,"image":"https://source.unsplash.com/1200x800/?tassili,algeria,hotel","maps":"https://maps.google.com/?q=Djanet"},
  {"id":"h63","name":"فندق برج الكيفان باي","state":"الجزائر","type":"فنادق","description":"قريب من الشاطئ في العاصمة.","lat":36.75,"lng":3.19,"image":"https://source.unsplash.com/1200x800/?beach,hotel","maps":"https://maps.google.com/?q=Bordj%20El%20Kiffan"},
  {"id":"h64","name":"فندق عين تموشنت بلو","state":"عين تيموشنت","type":"فنادق","description":"مياه صافية وشواطئ جميلة.","lat":35.31,"lng":-1.14,"image":"https://source.unsplash.com/1200x800/?clear,water,hotel","maps":"https://maps.google.com/?q=Ain%20Temouchent"},
  {"id":"h65","name":"فندق سعيدة هيل","state":"سعيدة","type":"فنادق","description":"مطل على التلال.","lat":34.83,"lng":0.15,"image":"https://source.unsplash.com/1200x800/?hill,hotel","maps":"https://maps.google.com/?q=Saida"},
  {"id":"h66","name":"فندق غرداية بوستيل","state":"غرداية","type":"فنادق","description":"تصميم محلي وزخارف.","lat":32.49,"lng":3.67,"image":"https://upload.wikimedia.org/wikipedia/commons/6/6e/Timgad_algeria_hotel.jpg","maps":"https://maps.google.com/?q=Ghardaia%20Hotel"},
  {"id":"h67","name":"فندق تندوف كارافان","state":"تندوف","type":"فنادق","description":"أجواء قوافل صحراوية.","lat":27.67,"lng":-8.15,"image":"https://upload.wikimedia.org/wikipedia/commons/0/09/Sahara_desert_hotel.jpg","maps":"https://maps.google.com/?q=Tindouf%20Hotel"},
  {"id":"h68","name":"فندق بومرداس سي سايد","state":"بومرداس","type":"فنادق","description":"قرب البحر والمقاهي.","lat":36.77,"lng":3.47,"image":"https://source.unsplash.com/1200x800/?seaside,hotel","maps":"https://maps.google.com/?q=Boumerdes"},
  {"id":"h69","name":"فندق تيبازة كورال","state":"تيبازة","type":"فنادق","description":"تصميم حديث وإطلالة بحرية.","lat":36.59,"lng":2.45,"image":"https://upload.wikimedia.org/wikipedia/commons/5/5a/Hotel_room_view.jpg","maps":"https://maps.google.com/?q=Tipaza%20Hotel"},
  {"id":"h70","name":"فندق البيض ستاي","state":"البيض","type":"فنادق","description":"إقامة مريحة للمسافرين.","lat":33.68,"lng":1.01,"image":"https://source.unsplash.com/1200x800/?hotel,room,desert","maps":"https://maps.google.com/?q=El%20Bayadh%20Hotel"}
];

// ====== التطبيق ======
let map, markersLayer;
let datasetMode = 'all'; // all | hotels
let currentList = [];

function initMap(){
  map = L.map('map',{scrollWheelZoom:false}).setView([28.3,2.7],5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
  markersLayer = L.layerGroup().addTo(map);
}

function allItems(){
  return datasetMode==='hotels' ? hotels.slice() : places.concat(hotels);
}

function renderMarkers(list){
  markersLayer.clearLayers();
  list.forEach(p=>{
    if(p.lat && p.lng){
      const m = L.marker([p.lat,p.lng]).addTo(markersLayer);
      m.bindPopup(`<strong>${p.name}</strong><br>${p.state}<br><button onclick="openDetail('${p.id}')">عرض</button>`);
    }
  });
}

function renderGrid(list){
  currentList = list;
  const grid = document.getElementById('grid');
  document.getElementById('resultsInfo').innerText = `عدد النتائج: ${list.length}`;
  grid.innerHTML = '';
  if(list.length===0){
    grid.innerHTML = `<div class="card"><p>لا توجد نتائج.</p></div>`;
    markersLayer.clearLayers();
    return;
  }
  list.forEach(p=>{
    const card = document.createElement('div'); card.className='card';
    const mapBtn = p.maps ? `<a href="${p.maps}" target="_blank" rel="noopener" class="ghost" style="text-decoration:none"><button class="ghost">🗺 خريطة</button></a>` : '';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.name}" loading="lazy" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/6/6c/No_image_available.svg'">
      <h3 style="margin:8px 0 4px">${p.name}</h3>
      <div class="meta"><span class="badge">${p.type||'—'}</span><span class="small">${p.state||''}</span></div>
      <p class="small" style="margin-top:6px">${p.description||''}</p>
      <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
        <button onclick="openDetail('${p.id}')">📄 التفاصيل</button>
        <button class="ghost" onclick="showNearby('${p.id}')">📍 قريب</button>
        ${mapBtn}
      </div>
    `;
    grid.appendChild(card);
  });
  renderMarkers(list);
}

function doSearch(term){
  const n = normalizeText(term);
  const base = allItems();
  if(!n){ renderGrid(base); map.setView([28.3,2.7],5); return; }
  const res = base.filter(p =>
    normalizeText(p.state||'').includes(n) ||
    normalizeText(p.name||'').includes(n) ||
    normalizeText(p.description||'').includes(n) ||
    normalizeText(p.type||'').includes(n)
  );
  renderGrid(res);
  if(res.length>0 && res[0].lat) map.setView([res[0].lat,res[0].lng],7);
}

function filterByType(t){
  const base = allItems();
  const res = base.filter(p => (p.type||'').includes(t) || normalizeText(p.description||'').includes(normalizeText(t)) || normalizeText(p.name||'').includes(normalizeText(t)));
  renderGrid(res);
  if(res.length>0 && res[0].lat) map.setView([res[0].lat,res[0].lng],8);
}

// geolocation
document.getElementById('locateBtn').addEventListener('click', ()=>{
  if(!navigator.geolocation){ alert('المتصفح لا يدعم تحديد الموقع'); return; }
  navigator.geolocation.getCurrentPosition(pos=>{
    const you = {lat:pos.coords.latitude,lng:pos.coords.longitude};
    L.marker([you.lat,you.lng],{title:'موقعك'}).addTo(markersLayer).bindPopup('أنت هنا').openPopup();
    const base = allItems();
    const withDist = base.map(p=>({...p, dist: calcDist(you.lat,you.lng,p.lat,p.lng)})).filter(x=>x.dist!==null);
    withDist.sort((a,b)=>a.dist-b.dist);
    renderGrid(withDist.slice(0,12));
    if(withDist[0]) map.setView([withDist[0].lat,withDist[0].lng],9);
  }, err=> alert('فشل تحديد الموقع: '+err.message));
});

function showNearby(id){
  const base = allItems();
  const origin = base.find(p=>p.id===id);
  if(!origin || !origin.lat) return alert('لا توجد إحداثيات كافية لهذا العنصر');
  const withDist = base.map(p=>({...p, dist: calcDist(origin.lat,origin.lng,p.lat,p.lng)}))
                       .filter(x=>x && x.id!==id && x.dist!==null && x.dist<=200);
  withDist.sort((a,b)=>a.dist-b.dist);
  if(withDist.length===0) return alert('لا توجد عناصر قريبة خلال 200 كم');
  renderGrid(withDist);
  if(withDist[0].lat) map.setView([withDist[0].lat,withDist[0].lng],9);
}

// تفاصيل + تقييم + تعليقات
function ratingKey(id){ return 'anes_rating_' + id; }
function loadRatings(id){
  const arr = JSON.parse(localStorage.getItem(ratingKey(id))||'[]');
  const count = arr.length;
  const avg = count? Math.round((arr.reduce((s,v)=>s+v,0)/count)*10)/10 : 0;
  return {count,avg,items:arr};
}
function saveRatingFor(id,value){
  const arr = JSON.parse(localStorage.getItem(ratingKey(id))||'[]'); arr.push(value);
  localStorage.setItem(ratingKey(id), JSON.stringify(arr));
}
function commentsKey(id){ return 'anes_comments_' + id; }

function openDetail(id){
  const base = allItems();
  const item = base.find(p=>p.id===id);
  if(!item) return;
  document.getElementById('detailView').style.display='block';
  const r = loadRatings(item.id);
  const mapBtn = item.maps ? `<a href="${item.maps}" target="_blank" rel="noopener"><button class="ghost">🗺 فتح في الخرائط</button></a>` : '';
  document.getElementById('detailCard').innerHTML = `
    <h2 style="margin-top:0">${item.name}</h2>
    <div class="meta"><span class="badge">${item.type||'—'}</span><span class="small">${item.state||''}</span></div>
    <img src="${item.image}" alt="${item.name}">
    <p style="margin-top:8px">${item.description||''}</p>
    <div style="margin-top:6px"><strong>التقييم الحالي:</strong> <span id="avgRating">${r.avg}</span> ★ &nbsp; (<span id="countRating">${r.count}</span>)</div>
    <div style="margin-top:10px">
      <label>قيّم:</label>
      <div id="starsInput" style="display:inline-block;margin-right:8px"></div>
      <button onclick="saveRating('${item.id}')">حفظ التقييم</button>
      ${mapBtn}
    </div>
    <div style="margin-top:10px">
      <label>أضف تعليق:</label><br>
      <textarea id="commentText" rows="3" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd"></textarea>
      <div style="margin-top:6px"><button onclick="saveComment('${item.id}')">نشر التعليق</button></div>
    </div>
    <div id="commentsList" style="margin-top:12px"></div>
  `;
  renderStarsInput('starsInput', item.id);
  renderComments(item.id);
  if(item.lat) { window.scrollTo({top:0,behavior:'smooth'}); }
}

function renderStarsInput(containerId,placeId){
  const c = document.getElementById(containerId); c.innerHTML='';
  for(let i=1;i<=5;i++){
    const s=document.createElement('span'); s.className='stars'; s.innerText='☆'; s.style.padding='2px'; s.dataset.value=i;
    s.addEventListener('click',()=>{[...c.children].forEach((ch,idx)=> ch.innerText = (idx < i ? '★' : '☆')); c.dataset.selected=i;});
    c.appendChild(s);
  }
}
function saveRating(id){
  const c=document.getElementById('starsInput'); const v=Number(c.dataset.selected||0);
  if(!v) return alert('اختر عدد النجوم');
  saveRatingFor(id,v);
  const r=loadRatings(id);
  document.getElementById('avgRating').innerText=r.avg;
  document.getElementById('countRating').innerText=r.count;
  alert('شكراً على تقييمك!');
}
function saveComment(id){
  const t=document.getElementById('commentText').value.trim();
  if(!t) return alert('اكتب تعليقاً');
  const arr = JSON.parse(localStorage.getItem(commentsKey(id))||'[]');
  arr.unshift({text:t,ts:new Date().toISOString()});
  localStorage.setItem(commentsKey(id), JSON.stringify(arr));
  document.getElementById('commentText').value='';
  renderComments(id);
}
function renderComments(id){
  const arr = JSON.parse(localStorage.getItem(commentsKey(id))||'[]');
  const list=document.getElementById('commentsList');
  if(!arr.length){ list.innerHTML='<p class="small">لا توجد تعليقات بعد.</p>'; return; }
  list.innerHTML = arr.map(c=>`<div class="comment"><div style="font-size:12px;color:#666">${new Date(c.ts).toLocaleString()}</div><div style="margin-top:6px">${c.text}</div></div>`).join('');
}

// أحداث الواجهة
document.getElementById('searchBtn').addEventListener('click',()=>doSearch(document.getElementById('searchBox').value));
document.getElementById('searchBox').addEventListener('input',(e)=>doSearch(e.target.value));
document.getElementById('clearBtn').addEventListener('click',()=>{ document.getElementById('searchBox').value=''; renderGrid(allItems()); map.setView([28.3,2.7],5); });
document.getElementById('showAllBtn').addEventListener('click',()=>{ renderGrid(allItems()); map.setView([28.3,2.7],5); });
document.querySelectorAll('.filterBtn').forEach(b=> b.addEventListener('click',()=> filterByType(b.dataset.type)));

document.getElementById('tabAll').addEventListener('click',()=>{
  datasetMode='all';
  document.getElementById('tabAll').classList.add('active');
  document.getElementById('tabHotels').classList.remove('active');
  renderGrid(allItems()); map.setView([28.3,2.7],5);
});
document.getElementById('tabHotels').addEventListener('click',()=>{
  datasetMode='hotels';
  document.getElementById('tabHotels').classList.add('active');
  document.getElementById('tabAll').classList.remove('active');
  renderGrid(allItems()); map.setView([28.3,2.7],5);
});

document.getElementById('backBtn').addEventListener('click',()=>{
  document.getElementById('detailView').style.display='none';
  document.getElementById('grid').scrollIntoView({behavior:'smooth'});
});

// بدء التشغيل
let mapReady=false;
window.addEventListener('load',()=>{
  initMap(); mapReady=true;
  renderGrid(allItems());
  window.openDetail = (id)=> openDetail(id);
  window.showNearby = (id)=> showNearby(id);
});
</script>

</body>
</html>
